<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (–ü–æ—Ö–æ–∂–µ –Ω–∞ Microsoft Word) —Å IndexedDB</title>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f3f3f3;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      background: #0078d7;
      color: white;
      padding: 12px 20px;
      font-size: 1.5rem;
      font-weight: 600;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    header .status {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    /* –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–ª–µ–Ω—Ç–∞, ribbon) */
    #toolbar {
      background: white;
      padding: 6px 10px;
      box-shadow: inset 0 -1px 0 #ddd;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      user-select: none;
    }
    #toolbar button, #toolbar select {
      background: white;
      border: 1px solid #ccc;
      border-radius: 3px;
      padding: 6px 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s, border-color 0.3s;
    }
    #toolbar button:hover, #toolbar select:hover {
      background: #e6f0ff;
      border-color: #0078d7;
    }
    #toolbar button:active {
      background: #cce0ff;
    }
    /* –ò–∫–æ–Ω–∫–∏ –∏–∑ Unicode –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã */
    button.bold::before { content: "ùêÅ"; font-weight: bold; }
    button.italic::before { content: "ùòê"; font-style: italic; }
    button.underline::before { content: "U"; text-decoration: underline; }
    button.save::before { content: "üíæ"; }
    button.clear::before { content: "üóëÔ∏è"; }
    /* –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ */
    #editor {
      flex-grow: 1;
      margin: 10px 20px 20px 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 20px;
      font-size: 1.1rem;
      line-height: 1.5;
      overflow-y: auto;
      outline: none;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      max-height: calc(100vh - 140px);
    }
    /* –°—Ç–∏–ª–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è toolbar –∫–Ω–æ–ø–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö */
    #toolbar button.active {
      background: #0078d7;
      color: white;
      border-color: #005a9e;
    }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 600px) {
      header {
        font-size: 1.2rem;
        padding: 10px;
      }
      #toolbar {
        gap: 6px;
        padding: 4px 8px;
      }
      #toolbar button, #toolbar select {
        padding: 5px 8px;
        font-size: 0.9rem;
      }
      #editor {
        margin: 8px 10px 12px 10px;
        font-size: 1rem;
        max-height: calc(100vh - 120px);
        padding: 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
    <div class="status" id="saveStatus">–°—Ç–∞—Ç—É—Å: –ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
  </header>

  <nav id="toolbar" aria-label="–ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤">
    <button type="button" id="boldBtn" class="bold" aria-label="–ñ–∏—Ä–Ω—ã–π (Ctrl+B)" title="–ñ–∏—Ä–Ω—ã–π (Ctrl+B)"></button>
    <button type="button" id="italicBtn" class="italic" aria-label="–ö—É—Ä—Å–∏–≤ (Ctrl+I)" title="–ö—É—Ä—Å–∏–≤ (Ctrl+I)"></button>
    <button type="button" id="underlineBtn" class="underline" aria-label="–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π (Ctrl+U)" title="–ü–æ–¥—á—ë—Ä–∫–Ω—É—Ç—ã–π (Ctrl+U)"></button>
    <select id="fontSelect" aria-label="–í—ã–±–æ—Ä —à—Ä–∏—Ñ—Ç–∞" title="–í—ã–±–æ—Ä —à—Ä–∏—Ñ—Ç–∞">
      <option value="Segoe UI" selected>Segoe UI</option>
      <option value="Arial">Arial</option>
      <option value="Tahoma">Tahoma</option>
      <option value="Georgia">Georgia</option>
      <option value="Courier New">Courier New</option>
    </select>
    <select id="fontSizeSelect" aria-label="–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞" title="–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞">
      <option value="1">10pt</option>
      <option value="2">13pt</option>
      <option value="3" selected>16pt</option>
      <option value="4">18pt</option>
      <option value="5">24pt</option>
      <option value="6">32pt</option>
      <option value="7">48pt</option>
    </select>
    <button type="button" id="saveBtn" class="save" aria-label="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"></button>
    <button type="button" id="clearBtn" class="clear" aria-label="–û—á–∏—Å—Ç–∏—Ç—å" title="–û—á–∏—Å—Ç–∏—Ç—å"></button>
  </nav>

  <main>
    <article id="editor" contenteditable="true" role="textbox" aria-multiline="true" spellcheck="true" aria-label="–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞">
      <p>–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å...</p>
    </article>
  </main>

  <script>
    (() => {
      const editor = document.getElementById('editor');
      const boldBtn = document.getElementById('boldBtn');
      const italicBtn = document.getElementById('italicBtn');
      const underlineBtn = document.getElementById('underlineBtn');
      const fontSelect = document.getElementById('fontSelect');
      const fontSizeSelect = document.getElementById('fontSizeSelect');
      const saveBtn = document.getElementById('saveBtn');
      const clearBtn = document.getElementById('clearBtn');
      const saveStatus = document.getElementById('saveStatus');

      let db;
      const DB_NAME = 'WordLikeEditorDB';
      const DB_STORE = 'docs';
      const DB_VERSION = 1;
      const DOC_KEY = 'document';

      // –û—Ç–∫—Ä—ã–≤–∞–µ–º IndexedDB –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –µ–µ
      function openDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open(DB_NAME, DB_VERSION);

          request.onerror = event => reject('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ' + event.target.errorCode);

          request.onupgradeneeded = event => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains(DB_STORE)) {
              db.createObjectStore(DB_STORE, { keyPath: 'id' });
            }
          };

          request.onsuccess = event => {
            db = event.target.result;
            resolve(db);
          };
        });
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ IndexedDB
      function loadDoc() {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(DB_STORE, 'readonly');
          const store = transaction.objectStore(DB_STORE);
          const request = store.get(DOC_KEY);

          request.onerror = () => reject('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
          request.onsuccess = () => {
            if(request.result && request.result.content){
              resolve(request.result.content);
            } else {
              resolve(null);
            }
          };
        });
      }

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ IndexedDB
      function saveDoc(content) {
        return new Promise((resolve, reject) => {
          const transaction = db.transaction(DB_STORE, 'readwrite');
          const store = transaction.objectStore(DB_STORE);
          const data = { id: DOC_KEY, content };
          const request = store.put(data);

          request.onerror = () => reject('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
          request.onsuccess = () => resolve();
        });
      }

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      function refreshToolbarStatus() {
        document.queryCommandState('bold') ? boldBtn.classList.add('active') : boldBtn.classList.remove('active');
        document.queryCommandState('italic') ? italicBtn.classList.add('active') : italicBtn.classList.remove('active');
        document.queryCommandState('underline') ? underlineBtn.classList.add('active') : underlineBtn.classList.remove('active');

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è font name
        try {
          const fontName = document.queryCommandValue('fontName').replace(/['"]/g, '');
          if (fontName) fontSelect.value = fontName;
        } catch {}

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è font size
        try {
          const fontSize = document.queryCommandValue('fontSize');
          if (fontSize) fontSizeSelect.value = fontSize;
        } catch {}
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      async function init() {
        try {
          await openDB();
          const content = await loadDoc();
          if(content){
            editor.innerHTML = content;
            saveStatus.textContent = '–°—Ç–∞—Ç—É—Å: –î–æ–∫—É–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω';
          }
        } catch (error) {
          saveStatus.textContent = error;
        }
      }

      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      boldBtn.addEventListener('click', () => {
        document.execCommand('bold');
        refreshToolbarStatus();
      });
      italicBtn.addEventListener('click', () => {
        document.execCommand('italic');
        refreshToolbarStatus();
      });
      underlineBtn.addEventListener('click', () => {
        document.execCommand('underline');
        refreshToolbarStatus();
      });

      fontSelect.addEventListener('change', () => {
        document.execCommand('fontName', false, fontSelect.value);
        refreshToolbarStatus();
      });

      fontSizeSelect.addEventListener('change', () => {
        document.execCommand('fontSize', false, fontSizeSelect.value);
        refreshToolbarStatus();
      });

      saveBtn.addEventListener('click', async () => {
        try {
          await saveDoc(editor.innerHTML);
          saveStatus.textContent = '–°—Ç–∞—Ç—É—Å: –î–æ–∫—É–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω';
          setTimeout(() => saveStatus.textContent = '–°—Ç–∞—Ç—É—Å: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 2000);
        } catch (e) {
          saveStatus.textContent = '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + e;
        }
      });

      clearBtn.addEventListener('click', () => {
        if(confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç? –î–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, –µ—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞–∂–º—ë—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å".')){
          editor.innerHTML = '<p></p>';
          refreshToolbarStatus();
          saveStatus.textContent = '–°—Ç–∞—Ç—É—Å: –ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
        }
      });

      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–∫–ª–∞–¥–∫–∏ –∫–Ω–æ–ø–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö
      editor.addEventListener('keyup', refreshToolbarStatus);
      editor.addEventListener('mouseup', refreshToolbarStatus);
      editor.addEventListener('input', () => {
        saveStatus.textContent = '–°—Ç–∞—Ç—É—Å: –ù–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      init();

      // –ú–æ–±–∏–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Å–¥–≤–∏–≥–æ–≤ –ø—Ä–∏ viewport
      window.addEventListener('resize', () => {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
      });
    })();
  </script>
</body>
</html>
</content>
</create_file>
